> 打开本文件有困难 或 阅读时无格式, 建议安装 **Typora**.

# Java Spring入门培训

## 〇. 前言

Spring框架是由于软件开发的复杂性而创建的。Spring使用的是基本的JavaBean来完成以前只可能由EJB完成的事情。然而，Spring的用途不仅仅限于服务器端的开发。从简单性、可测试性和松耦合性角度而言，绝大部分Java应用都可以从Spring中受益。

Spring是一个轻量级控制反转(IoC)和面向切面(AOP)的容器框架。

Spring Boot是由Pivotal团队提供的全新框架，其设计目的是用来简化新Spring应用的初始搭建以及开发过程。该框架使用了特定的方式来进行配置，从而使开发人员不再需要定义样板化的配置。通过这种方式，Spring Boot致力于在蓬勃发展的快速应用开发领域(rapid application development)成为领导者。

### 任务评价指标(适用于Java)

|   指标   | 占比 | 描述                                                         | 关联的属性         |
| :------: | :--: | ------------------------------------------------------------ | ------------------ |
| 可维护性 | 30%  | 自己与其他人看懂代码的方便程度 + 自己与其他人修改代码及查找BUG的方便程度 | 代码风格, 架构设计 |
| 可使用性 | 20%  | 需求中提及的功能的实现程度 + 处理极端案例、错误案例、攻击性案例的健壮程度 + 算法性能的优秀程度. | 功能               |
| 可扩展性 | 15%  | 在程序中加入新功能的方便程度                                 | 架构设计           |
| 可重用性 | 10%  | 程序的全部或部分内容稍加改造或不改造就可以助力于其它程序开发的能力的程度 | 架构设计           |
| 学习能力 | 10%  | 新知识的吸收速度 + 支持库(包含原生Java包和其它依赖库)的搜寻与使用的能力的程度 | 个人能力与习惯     |
| 开发速度 | 10%  | 编写成品程序的速度 + 定位和修改BUG的速度                     | 个人能力与习惯     |
| 可移植性 |  5%  | 对操作系统迁移, 文件目录迁移的支持程度                       | 架构设计           |

## 一. 环境安装

### 1. 墙外环境

**任何一个程序员都应该时常处于或有能力在必要时处于墙外环境下**, 结合Java Spring开发, 具体原因如下:

1. 下载Maven依赖和其它配套资源使用的服务器, 以及IntelliJ IDEA的插件服务器, 在国内环境下都不太稳定, 速度慢且容易下载失败.
3. [github.io](https://www.github.io)处于被屏蔽状态, 而[github](https://github.com)、[stackoverflow](https://stackoverflow.com/)等网站连接速度很慢, 这对所有程序员来讲都是很大的阻碍.
4. 在墙外还可以通过Google和YouTube来获取其他语种开发者所拥有的更多资源, 比孤立的中文环境丰富不少.

结论: **可以考虑在墙外环境学习和使用Java Spring**. 这需要网络代理相关知识, 在部分软件中需要手动配置代理.

### 2. 安装Java

建议使用统一的Java版本. 目前使用的Java版本是: `JDK 14.0.2`, 尽量保证相等或更高.

### 3. 熟悉IDE

我们推荐使用 **IntelliJ IDEA (Ultimate)** 进行开发, 使用 **STS** 需要自行解决差异问题.

目前的 IntelliJ IDEA 版本为`2020.2.2`, 尽量保证相等或更高.

### 4. 配置练习环境

请先搭建自己的练习环境(如MySQL)进行学习, 遇到不能确定的问题也在练习环境下调试.

我们使用的MySQL版本是`8.0.19`, 尽量保证相等或更高.

## 二. 练习Java语言

请完成下面这个任务:

### 任务简介

**我们打算开发一套新型AI对话机器人(我们叫它RobotABC, 当然你也可以起昵称), 要求如下**:

- 我们首先为它手动存储以下数据:

	- 关键词集, 及其对应的回答语句. 关键词与回答语句是多对多关系(但可以通过附加额外的处理来简化成一对多)
	- 敏感词集, 以及发现敏感词时的回答语句. 敏感词与回答语句无关联, 二者是孤立的
	- 缺省的回答语句集

- 等待用户输入一段话

- 将用户输入中的标点进行如下替换:  

	| 替换前                                                  | 替换后                     |
	| ------------------------------------------------------- | -------------------------- |
	| ，(全角)                                                | ,(半角)                    |
	| 。(全角)                                                | .(半角)                    |
	| ！(全角)                                                | !(半角)                    |
	| ？(全角)                                                | ?(半角)                    |
	| ……(注意这是两个字符)                                    | ...(注意这是三个字符)      |
	| 多于1个连续句号. 包含全半角混合的情况, 如"。....。..。" | ...(注意这是三个字符)      |
	| 多于1个连续的其他符号, 包含全半角混合的情况, 如"！!!"   | 1个该符号的半角字符, 如"!" |

	我们保证输入只有这么几种标点符号

- 把用户输入的一段话按照标点符号拆分成句(每个标点符号都单独分割一句, 包括逗号). 接下来的所有回答操作都是按句划分进行处理的, 结束处理后, 将所有回答语句按照相应输入的原有顺序组装好, 作为输出. 但每一句输入语句对应的输出并不一定只有一句!

**以下是对回答的描述, 每一项都是一个情景捕获规则**(采取非贪婪捕获原则, 捕获到任意规则满足时, 就立即停止后续捕获):

- 若**存在至少一个敏感词**, 则从敏感词回答语句集中随机挑选一句作为回答. 此处的随机是加权的, **越少用到的选项权值越高, 加权算法请自拟**.
- 若**存在至少一个关键词**, 则在出现次数最多的关键词(集)映射到的回答语句集中随机挑选一句作为回答. 注意, 在多个关键词出现次数相同时, 每个关键词对应的回答语句都应加入到回答可能选项中, 且**相同的回答语句只计算一次**. 此处的随机是加权的, **越少用到的选项权值越高**. 关键词是允许重复匹配的, 即`哈哈`和`哈哈哈`都会匹配入`哈哈哈哈哈`, `哈哈`匹配到4次, `哈哈哈`匹配到3次.
- 若既不存在敏感词, 也不存在关键词, 则按照如下顺序进行流水匹配:
	- 如果**以`任意非空文本+吗+任意标点或无字符`结尾**, 则将输入中的`吗?`替换为`!`, 将输入中的`你`和`您`替换成`我`, 将输入中的`我`替换成`你`, 并保证结尾标点是`.`, 作为回答
	- 如果**以`任意非空文本+是+任意非空文本+吧+任意标点或无字符`结尾**, 则随机回答`是的!`或`不是的!`, 两种回答各有50%机率
	- 如果**以`任意非空文本+吧+任意标点或无字符`结尾**, 则随机回答`好啊!`或`不行的...`, 两种回答各有50%机率
	- 如果**以`...`结尾**, 则回答`那也是没办法的事啦!`
	- 如果**内容只有标点符号**, 则回答`怎么了?`
	- 如果**内容中的汉字字数少于等于三个**, 则回答`嗯嗯.`
- 最后兜底, **随机挑选缺省回答语句集中的一句**作为回答

### 数据格式

关键词集是一个名为`关键词集.json`的**json格式的文本文件**, 编码为`UTF-8`, 形式如下(由于是多对多映射, 回答语句可能在不同关键词中出现重复):

```json
{
    "关键词1": ["回答语句1", "回答语句2", ...],
    "关键词2": ["回答语句3", "回答语句4", ...],
    ...
}
```

敏感词集是一个名为`敏感词集.txt`的**纯文本文件**, 行尾为`LF`, 编码为`UTF-8`, 形式如下:

```
[word]
敏感词1
敏感词2
...
[result]
回答语句1
回答语句2
...
```

缺省回答语句集是一个名为`缺省集.txt`的**纯文本文件**, 行尾为`LF`, 编码为`UTF-8`, 形式如下:

```
缺省回答语句1
缺省回答语句2
...
```

从stdin输入的数据, 第一行是一个正整数n, 表示接下来有n段话需要处理.

第二行开始, 接下来的n行, 每行一段话. 

**保证特殊符号只有上述提及的标点、半角空格( )和`-`, `_`, `'`, 保证正式内容全部为中文汉字、英文大小写字母或阿拉伯数字**. 不强制要求文本编码, 可以自拟或使用控制台默认编码.

### 样例

`关键词集.json`:

```json
{
    "你好": ["你好.", "你也好!", "我很好."],
    "我爱你": ["我也爱你!", "呜呜人家还没准备好!"],
    "豆豆": ["我是豆豆小迷弟!", "豆豆太帅了!", "超喜欢豆豆der!", "豆豆好可爱哦!", "你也认识豆豆?"],
    "叫什么": ["豆豆2号.", "我叫豆豆2号.", "猜对我就告诉你!"],
    "你的名字是": ["豆豆2号.", "我叫豆豆2号."],
    "你的名字": ["一部电影.", "只要记住你的名字,不管你在世界的哪个地方,我一定会去见你.", "你也看过?", "重要之人,不能忘记之人,不想忘记之人.", "新海诚还是可以的."]
}
```

`敏感词集.txt`:

```
[word]
你妈的
傻逼
[result]
粗鄙之语...
你妈就这么教你说话的?
我不听我不听!
自重一点好吗?
```

`缺省集.txt`:

```
不懂你在说什么哦!
听不懂...
那个,你能换种说法嘛?
```

`stdin`:

```
6
你好,豆豆是傻逼吗?豆豆是神经病吗?你是神经病吗?你是神经病吧!
你的名字叫什么?你的名字叫什么?你的名字是什么?你的名字是什么?
我爱你!如果我是DJ你会爱我吗?
多冷的隆冬哒哒哒。。。你听过这首歌吗？我们一起唱吧!!!多冷啊我在东北玩泥巴!
?!??？？????
豆豆2号.你是豆豆2号.
```

`stdout`:

```
你好.你妈就这么教你说话的?我是豆豆小迷弟!我是神经病.是的!
新海诚还是可以的.猜对我就告诉你!我叫豆豆2号.重要之人,不能忘记之人,不想忘记之人.
呜呜人家还没准备好!如果你是DJ我会爱你.
那也是没办法的事啦!我听过这首歌.不行的...不懂你在说什么哦!
怎么了?怎么了?怎么了?
嗯嗯.那个,你能换种说法嘛?
```

### 任务要求

- 请建立Java程序(控制台程序)实现上述功能.

- 以尽可能严谨的面向对象思维进行设计.

- 使用**Maven**作为项目管理系统.

- 使用**Jackson库**进行Json数据的序列化/反序列化, 至于是否用它做Json数据维护, 请自便.

- 除Jackson外, 可**任意使用现成的依赖库完成任意功能**.

- **建议编写以下几个包和类(接口)**, 仅为建议, 最终还是需要自己设计架构:

	| (包名)类名/接口名     | 功能                                                         |
	| --------------------- | ------------------------------------------------------------ |
	| RobotABC              | main类, 主程序的编写位置                                     |
	| (processor)ProcessorI | 处理器接口, 所有的处理器类(如关键词处理器、敏感词处理器)都实现此接口 |
	| (tools)StringTool     | 字符串工具类                                                 |

## 三. 学习SpringBoot框架

### 1. 跟随网课速成SpringBoot

> ##### 此时, 默认你已经有了:
>
> - **IP、HTTP请求/响应、端口** 等基础的网络知识.
> - **Java** SE 语言基础知识.
> - **关系型数据库**基础知识.
>
> ##### SpringBoot是什么?
>
> - SpringBoot是**Spring、SpringMVC等现有技术的整合**.
> - 原则上, SpringBoot除了整合还是整合, 与手动的集成**没有功能性的差别**.
> - 但SpringBoot的一波操作带来了**让大型项目快速成型**的显著优势, 同时也**利于初学者快速上手**.
> - Spring使用xml作为配置文件, 在大型架构的维护和整理方面面临严峻的考验; 而SpringBoot使用**纯注解(Annotation)作为配置**, 使用封装好的各种注解类, 实现了Java代码和Spring框架配置的同时同地统一维护.
> - 综上所述, SpringBoot可以作为Spring世界的一块敲门砖, 快速上手, 快速成型; 同时它也是Spring世界的集大成者, 是"先由厚变薄, 再由薄变厚"的典型.
>
> ##### 我们要干什么?
>
> - 我们使用SpringBoot搭建供Web前端和APP端使用的**Web API服务器**, 由于业务需求, 我们的开发相对传统开发模式, 有以下几个重要特点:
> 	- 前后端分离, **不需要JSP、模板引擎**等涉及网页处理的功能.
> 	- **使用通用的MVC架构**(但不涉及视图层).
> 	- **尽可能多地使用注解**进行业务实现.
> 	- **使用Mybatis**而非Spring Data JPA进行关系型数据库操作. 当然你也可以简单理解为: 我们的项目使用的是SSM框架(Spring+SpringMVC+MyBatis)的注解版.
> - 因此, 在学习时, 你也可以考虑**着重关注我们的开发中主要涉及到的内容**, 适当忽略不涉及的内容 -- 这其实也是当今Java Web领域的年轻态开发趋势.

推荐跟随**以下几个网课**, 学习SpringBoot框架:

1. [千峰 SpringBoot 快速入门](https://www.bilibili.com/video/BV1ti4y1G7yX)
2. [楠哥 SpringMVC](https://www.bilibili.com/video/BV1GE411d7KE)
3. [尚硅谷 SpringBoot](https://www.bilibili.com/video/BV1gW411W76m)

**建议的学习路径**:

- `1 => 2 => 3`
- `1`可直接入门SpringBoot, 建议跟着听
- `2`是SpringMVC的专门教程, 有必要深入学习
- `3`是较为详尽的SpringBoot教程, 涉及到yml配置、日志系统以及更多的深入内容, 在宏观程度理解即可(看不完也无所谓).

**参考资料**:

- [什么是controller/service/mapping?](https://blog.csdn.net/u011095110/article/details/86088976?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.add_param_isCf&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.add_param_isCf)

### 2. 练习SpringBoot的使用

请循序渐进完成以下五个任务(也可自拟难度和目的相似的任务进行替换):

- [ ] 一个简单的Hello程序(8001端口)
- [ ] RobotABC(8001端口)
- [ ] 一个登陆注册程序(8002端口)
- [ ] 一个日记本系统(8002端口)
- [ ] 分页的日记本系统(8002端口)

相同端口的程序直接写在同一个项目中即可.

注意, **所有的任务都不强制要求前端界面**, 使用浏览器或Postman或Intellij IDEA或其他网络请求工具能够证明程序逻辑正确即可.

#### (1) 一个简单的Hello程序(8001端口)

- 此任务的目的是入门SpringBoot.

使用**GET**请求访问`http://localhost:8001/hello/{name}?sex={sex}`. 

此时, 正在监听`8001`端口的SpringBoot服务器将响应一段`UTF-8`编码的纯文本:

```c
Hello! {sex为1或空 => "Mr.", 为2 => "Mrs."} {name}!
```

此处是伪代码表示, 仅用于描述程序逻辑. 如访问`http://localhost:8001/hello/豆豆?sex=1`时, 应得到响应:

````
Hello! Mr. 豆豆!
````

#### (2) RobotABC(8001端口)

- 此任务的目的是入门SpringBoot.

将Java练习中的RobotABC转移到SpringBoot服务器里来.

使用**POST**请求访问`http://localhost:8001/robot`, 并传递如下格式的数据(`content-type`设定为`application/json`, 编码为`UTF-8`):

```json
{
    "inputParagraph": 原本在stdin中输入的一个段落,
}
```

此时, SpringBoot服务器将响应一段`UTF-8`编码的纯文本:

```
原本在stdout中输出的一个段落
```

#### (3) 一个登陆注册程序(8002端口)

- 此任务的目的是入门Mybatis, 熟悉SpringBoot与Mybatis交互, 复习数据库基础知识, 进一步深入使用SpringBoot.

建立一个数据库, 其中包含表`user`, 表的内容如下:

```mysql
🔑`username` VARCHAR(16)
  `password` VARCHAR(16)
  `lastLoginTime` DATETIME DEFAULT CURRENT_TIMESTAMP
```

我们约定, `username`和`password`两个字段的内容只能由英文字母、阿拉伯数字或下划线(_)组成. 这也是本程序需要做的数据验证之一.

你需要**实现以下两个功能**(请求和响应的`content-type`都设定为`application/json`):

- 使用**POST**请求访问`http://localhost:8002/api/doRegister`, 并传递如下格式的数据:
	```json
	{
	    "username": 你的用户名,
	    "password": 你的密码
	}
	```
	如果`user`表中已有相同用户名的记录, 则直接返回:
	```json
	{
	    "res": "already exists"
	}
	```
	我们的约束除了建表时提到的字段内容外, 还有长度限制: 两个字段的文本长度, 都必须介于`[5,16]`之间, 否则判定为输入不正确, 返回:

	```json
	{
	    "res": "too short value"
	}
	```
	
	如果通过了上述两项检查, 我们即可操作数据库, 使用给定的用户名和密码创建一个用户. 如果创建失败, 返回:
	
	```json
	{
	    "res": "unknown sql error"
	}
	```
	
	如果创建成功, 返回:
	
	```json
	{
	    "res": "ok"
	}
	```
	
- 使用**POST**请求访问`http://localhost:8002/api/doLogin`, 并传递如下格式的数据:
	```json
	{
	    "username": 你的用户名,
	    "password": 你的密码
	}
	```
	
	如果`user`表中没有相同用户名的记录, 则直接返回:
	
	```json
	{
	    "res": "not exists"
	}
	```
	
	如果密码不正确, 则返回:
	
	```json
	{
	    "res": "wrong password"
	}
	```
	
	通过上述两项检查后, 开始更新`user`表对应的`username`记录的`lastLoginTime`字段, 更新为当前时间. 如果更新失败, 则返回:
	
	```json
	{
	    "res": "unknown sql error"
	}
	```
	
	如果更新成功, 则返回:
	
	```json
	{
	    "res": "ok",
	    "lastLoginTime": 更新前的lastLoginTime
	}
	```

	> 此处的时间更新可以直接执行sql命令来实现. 但在其它环境下, 根据业务的不同, 以及简化程序的要求, 有可能会直接使用触发器 -- 比如下一个任务.

#### (4) 一个日记本系统(8002端口)

- 此任务的目的是: 接触真实的后端开发, 进一步深入练习后端数据库业务.

在上一个登陆系统的基础上, 建立表`diary`, 表的内容如下:

```mysql
🔑`username` VARCHAR(16) 👉 FOREIGN KEY(`user`.`username`)
🔑`title` VARCHAR(50) COLLATE utf8mb4_bin
  `content` TEXT COLLATE utf8mb4_bin
  `modifiedTime` DATETIME DEFAULT CURRENT_TIMESTAMP
```

你需要使用与上一个任务类似的方式, **创建一些Web API**(请求和响应的`content-type`都设定为`application/json`):

这里提供两种选择, 即 平板式的 和 整合式的:

- 平板式API (Path是动宾短语, 方法不重要):

	| API Path         | 请求方法 | 功能描述               |
	| ---------------- | -------- | ---------------------- |
	| /api/createDiary | GET/POST | 创建一篇日记           |
	| /api/getDiary    | GET/POST | 获取一篇日记           |
	| /api/editDiary   | GET/POST | 修改一篇日记           |
	| /api/deleteDiary | GET/POST | 删除一篇日记           |
	| /api/listDiary   | GET/POST | 列出某个用户的日记列表 |
	
- 整合式API (Path是名词, 方法代表行为):

	| API Path       | 请求方法 | 功能描述               |
	| -------------- | -------- | ---------------------- |
	| /api/diary     | POST     | 创建一篇日记           |
	| /api/diary     | GET      | 获取一篇日记           |
	| /api/diary     | PUT      | 修改一篇日记           |
	| /api/diary     | DELETE   | 删除一篇日记           |
	| /api/diaryList | GET      | 列出某个用户的日记列表 |

请参考上一个任务, **自拟API的输入输出规则, 并给出接口文档**. 原则上是不限定文档格式的, 这里仅给出一种参考格式:

`API名称.txt`:

```
API的简介

请求方法(GET/POST/...) - {
	请求参数列表及解释...
} - {
	响应参数列表及解释...
}

关于某些特殊参数的补充说明
```

> 综上所述, 本任务最终的成果应当有三件: **Java源码、接口文档、建库使用的SQL**.

#### (5) 分页的日记本系统(8002端口)

- 此任务的目的是: 接触真实的后端开发, 进一步深入练习后端数据库业务.

根据自己的学习, 给我们的日记本系统的`list`接口**添加一个分页功能, 每页只显示10条日记**. 这样才能避免存在超多条记录时 响应缓慢 和 大规模流量浪费 的问题.

记得要**更新对应的接口文档**.

> 在实际业务中, 对数据列表的分页是一个必不可少的环节, 缺少此环节还能正常跑起来的业务, 显然是没经历过数据的毒打.

### 3. 还可以学什么?

参考[开发技术指南](./瀚抒新后端(Java)开发技术指南.md), 获得更多信息.

-----

**没错, 你全都看完了, 要不再翻回去看一遍?**

